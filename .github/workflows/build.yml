name: Build BLE Spam with Official Firmware

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout BLE Spam
      uses: actions/checkout@v4
      
    - name: Clone Official Firmware
      run: |
        git clone --recursive https://github.com/flipperdevices/flipperzero-firmware.git
        cd flipperzero-firmware
        git checkout release
        
    - name: Copy BLE Spam
      run: |
        mkdir -p flipperzero-firmware/applications/ble_spam
        cp -r ./* flipperzero-firmware/applications/ble_spam/
        ls -la flipperzero-firmware/applications/ble_spam/
        
    - name: Setup FBT
      run: |
        cd flipperzero-firmware
        ./fbt --help
        
    - name: Build Application
      run: |
        cd flipperzero-firmware
        ./fbt fap_ble_spam
        
    - name: Upload FAP
      uses: actions/upload-artifact@v4
      with:
        name: ble-spam-fap
        path: flipperzero-firmware/build/f7-firmware-D/.extapps/ble_spam.fap
