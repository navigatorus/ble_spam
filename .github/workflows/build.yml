name: Build BLE Spam Debug

on: [workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout BLE Spam
      uses: actions/checkout@v4
      
    - name: Clone and setup firmware
      run: |
        git clone --recursive https://github.com/flipperdevices/flipperzero-firmware.git
        cd flipperzero-firmware
        git checkout 0.98.1
        
    - name: Copy and verify files
      run: |
        cd flipperzero-firmware
        mkdir -p applications_user/ble_spam
        
        # –ö–æ–ø–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã
        cp -r ../assets ../scenes ../protocols ../icons applications_user/ble_spam/
        cp ../ble_spam.c ../ble_spam.h ../application.fam ../ble_spam_10px.png ../LICENSE.txt applications_user/ble_spam/
        
        echo "‚úÖ –§–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã"
        echo "üìÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:"
        find applications_user/ble_spam -type f -name "*.c" -o -name "*.h" -o -name "*.fam" | sort
        
    - name: Try to build
      run: |
        cd flipperzero-firmware
        echo "üõ†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ —Å–±–æ—Ä–∫–∏..."
        ./fbt fap_ble_spam || echo "‚ùå –°–±–æ—Ä–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º..."
        
    - name: Check what was built
      run: |
        cd flipperzero-firmware
        echo "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:"
        find . -name "*.fap" -type f 2>/dev/null | head -10 || echo "FAP —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
        ls -la dist/f7-C/faps/ 2>/dev/null || echo "–ü–∞–ø–∫–∞ faps –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
        
    - name: Upload whatever was created
      uses: actions/upload-artifact@v4
      with:
        name: ble-spam-debug
        path: |
          flipperzero-firmware/dist/
          flipperzero-firmware/build/
        if-no-files-found: warn
