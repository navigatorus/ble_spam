name: Build BLE Spam with Xtreme Firmware

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout BLE Spam
      uses: actions/checkout@v4
      
    - name: Clone Xtreme Firmware
      run: |
        git clone --recursive --depth=1 https://github.com/Flipper-XFW/xfw.git
        cd xfw
        git checkout dev
        
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y git wget python3 python3-pip cmake build-essential libusb-1.0-0-dev
        cd xfw
        pip3 install -r requirements.txt
        
    - name: Copy BLE Spam to applications
      run: |
        # –ö–æ–ø–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Xtreme Firmware
        cp -r . xfw/applications/ble_spam/
        
        # –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–µ–µ
        rm -rf xfw/applications/ble_spam/.github
        rm -rf xfw/applications/ble_spam/xfw
        
        echo "üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞:"
        ls -la xfw/applications/ble_spam/
        
    - name: Build BLE Spam
      run: |
        cd xfw
        ./fbt firmware_ble_spam
        
    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: ble-spam-xtreme
        path: |
          xfw/build/f7-firmware-D/.extapps/ble_spam.fap
          xfw/dist/f7-C/faps/ble_spam.fap
        if-no-files-found: warn
