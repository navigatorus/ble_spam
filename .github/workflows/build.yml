name: Build BLE Spam FAP

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-fap:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout BLE Spam
      uses: actions/checkout@v4
      
    - name: Set up Flipper environment
      uses: flipperdevices/flipperzero-firmware-action@v1
      env:
        FLIPPER_FIRMWARE: "https://github.com/Flipper-XFW/xfw.git"
        FLIPPER_BRANCH: "dev"
        
    - name: Build FAP
      run: |
        # Создаем временную структуру
        mkdir -p /tmp/fap_build/applications/ble_spam
        cp -r . /tmp/fap_build/applications/ble_spam/
        
        # Собираем через официальный инструмент
        cd /tmp/fap_build
        echo "Сборка BLE Spam..."
        find applications/ble_spam -name "*.c" | head -5
        
    - name: Create dummy FAP for testing
      run: |
        mkdir -p dist
        echo "This is a placeholder FAP file" > dist/ble_spam.fap
        echo "Actual compilation requires full Flipper toolchain" > dist/README.txt
        echo "FAP Version: 1.0" >> dist/ble_spam.fap
        echo "App Name: BLE Spam" >> dist/ble_spam.fap
        
    - name: Upload placeholder FAP
      uses: actions/upload-artifact@v4
      with:
        name: ble-spam-placeholder
        path: dist/
