name: Build BLE Spam

on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout BLE Spam
      uses: actions/checkout@v4
      
    - name: Clone Unleashed Firmware
      run: |
        git clone https://github.com/DarkFlippers/unleashed-firmware.git
        cd unleashed-firmware
        
    - name: Copy BLE Spam files
      run: |
        cd unleashed-firmware
        mkdir -p applications/ble_spam
        cp -r ../assets ../scenes ../protocols ../icons applications/ble_spam/
        cp ../*.c ../*.h ../*.fam ../*.png ../LICENSE.txt applications/ble_spam/
        
        echo "=== Files copied ==="
        ls -la applications/ble_spam/
        
    - name: Build FAP
      run: |
        cd unleashed-firmware
        ./fbt fap_ble_spam
        
    - name: Upload FAP
      uses: actions/upload-artifact@v4
      with:
        name: ble-spam-fap
        path: unleashed-firmware/dist/f7-C/faps/ble_spam.fap
